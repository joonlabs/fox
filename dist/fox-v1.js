!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"Vec2D",function(){return g});var o={};i.r(o),i.d(o,"Audio",function(){return u}),i.d(o,"Texture",function(){return m}),i.d(o,"TextureAtlas",function(){return y});var r={};i.r(r),i.d(r,"Collider",function(){return R}),i.d(r,"CircleCollider",function(){return L}),i.d(r,"RectangleCollider",function(){return j});var s={};i.r(s),i.d(s,"PointLight",function(){return S});var a={};i.r(a),i.d(a,"Circle",function(){return P}),i.d(a,"Rectangle",function(){return E}),i.d(a,"Sprite",function(){return M}),i.d(a,"Lights",function(){return s});var h={};i.r(h),i.d(h,"Canvas",function(){return N}),i.d(h,"Lightning",function(){return V});var c={};i.r(c),i.d(c,"Canvas2D",function(){return X}),i.d(c,"WebGL",function(){return B});class d{constructor({}={}){}onInit({object:t}={},e=this){}onCalc({object:t}={},e=this){}onBeforeRender({object:t}={},e=this){}onAfterRender({object:t}={},e=this){}onDestroy({object:t}={},e=this){}}class l{constructor(){this.loaded=!1}getData(t=this){}}class u extends l{constructor({src:t,volume:e}={}){super();let i=this;this.loaded=!1,this.src=t,i.data=new window.Audio(t),i.data.onloadeddata=function(){i.loaded=!0},i.data.volume=null==e?1:e/100}play({loop:t,jumpToSecsAfterLoop:e}={},i=this){i.data.currentTime=0,i.data.play(),t&&i.data.addEventListener("timeupdate",function(){this.currentTime>this.duration-.64&&(this.currentTime=null==e?0:e,this.play())})}pause(){this.data.pause()}setVolume({volume:t}={}){this.data.volume=t/100}}class x{constructor(){}add({vector:t}={},e=this){if("Vec2D"===t.constructor.name&&"Vec2D"===e.constructor.name)return new g({x:t.x+e.x,y:t.y+e.y});console.warn("src: vector: you're trying to add at least one object that is not a vector. this operation failed.")}sub({vector:t}={},e=this){if("Vec2D"===t.constructor.name&&"Vec2D"===e.constructor.name)return new g({x:e.x-t.x,y:e.y-t.y});console.warn("src: vector: you're trying to subtract at least one object that is not a vector. this operation failed.")}hadamard({vector:t}={},e=this){return new g({x:t.x*e.x,y:t.y*e.y})}dotProduct({vector:t}={},e=this){return t.x*e.x+t.y*e.y}addScalar({scalar:t}={},e=this){return new g({x:t+e.x,y:t+e.y})}subScalar({scalar:t}={},e=this){return new g({x:e.x-t,y:e.y-t})}multScalar({scalar:t}={},e=this){return new g({x:t*e.x,y:t*e.y})}}class g extends x{constructor({x:t,y:e}={}){super(),this.x=t||0,this.y=e||0}clone(){return new g({x:this.x,y:this.y})}}class p{constructor({r:t,g:e,b:i,a:n}={}){this.r=t||0,this.g=e||0,this.b=i||0,this.a=void 0===n?1:n}toString(t=this){return`rgba(${t.r},${t.g},${t.b},${t.a})`}}class f{static range({min:t,max:e}={min:0,max:1}){return Math.random()*(e-t)+t}static rangeInt({min:t,max:e}={min:0,max:1}){return parseInt(Math.random()*(e+1-t)+t)}static color({useAlpha:t}={useAlpha:!1}){return new p({r:f.range({min:0,max:1}),g:f.range({min:0,max:1}),b:f.range({min:0,max:1}),a:t?f.range({min:0,max:1}):1})}static ID(){let t=new Uint32Array(8);window.crypto.getRandomValues(t);let e="";for(let i=0;i<t.length;i++)e+=(i<2||i>5?"":"-")+t[i].toString(16).slice(-4);return e}}class m extends l{constructor({src:t,offset:e,width:i,height:o}){super();let r=this;if(this.data=void 0,this.id=f.ID(),this.width=i,this.height=o,this.offset=e||new n.Vec2D,this.dimensions=new n.Vec2D,this.loaded=!1,this.rendering={canvas:document.createElement("canvas"),ctx:void 0,data:void 0},this.rendererData={texture:void 0},void 0!==t){let e=document.createElement("img");e.src=t,e.onload=function(){r.rendering.canvas=document.createElement("canvas"),r.rendering.ctx=r.rendering.canvas.getContext("2d"),void 0===r.width&&(r.width=e.width),void 0===r.height&&(r.height=e.height),r.rendering.canvas.width=e.width,r.rendering.canvas.height=e.height,r.rendering.ctx.drawImage(e,0,0),r.rendering.data=r.rendering.ctx.getImageData(0,0,e.width,e.height),r.loaded=!0,r.dimensions=new n.Vec2D({x:e.width,y:e.height})},e.onerror=function(){console.error("src: asset: texture: failed to load resource '"+t+"'")}}}static fromCanvas({canvas:t,ctx:e}){let i=new m({src:void 0,width:t.width,height:t.height});return i.rendering.canvas=t,i.rendering.ctx=e||t.getContext("2d"),i.rendering.data=i.rendering.ctx.getImageData(0,0,i.width,i.height),i.loaded=!0,i.dimensions=new n.Vec2D({x:i.width,y:i.height}),i}getId(){return this.id}getTexture(t=this){return t.rendering.canvas}getData(t=this){return t.rendering.data}getWidth(t=this){return t.width}getHeight(t=this){return t.height}getOffset(t=this){return t.offset}}class y extends l{constructor({src:t,mappings:e}){super();let i=this;this.mappings=e,this.dimensions=void 0,this.textureLoaded=!1,this.onTextureLoadedFn=function(){},this.rendering={canvas:document.createElement("canvas"),ctx:void 0,data:void 0};let o=document.createElement("img");o.src=t,o.onload=function(){i.rendering.canvas=document.createElement("canvas"),i.rendering.ctx=i.rendering.canvas.getContext("2d"),i.rendering.canvas.width=o.width,i.rendering.canvas.height=o.height,i.rendering.ctx.drawImage(o,0,0),i.rendering.data=i.rendering.ctx.getImageData(0,0,o.width,o.height),i.dimensions=new n.Vec2D({x:o.width,y:o.height}),i.textureLoaded=!0,i.onTextureLoadedFn()},o.onerror=function(){console.error("src: asset: texture: failed to load resource '"+t+"'")}}onTextureLoaded({callback:t}){this.onTextureLoadedFn=t,this.textureLoaded&&this.onTextureLoadedFn()}getAllTextures(){let t=[];for(let e of this.mappings){let i=document.createElement("canvas"),n=i.getContext("2d"),o=this.rendering.ctx.getImageData(e.x,e.y,e.width,e.height);i.width=e.width,i.height=e.height,n.putImageData(o,0,0);let r=new m({src:i.toDataURL(),offset:e.offset,width:e.width,height:e.height});t.push({name:e.name,texture:r})}return t}}class w{static addAudio({name:t,asset:e}={}){w.objects.audio[t]=e}static addTexture({name:t,asset:e}={}){w.objects.texture[t]=e}static addTextureAtlas({atlas:t}={}){w.objects.textureAtlases.push(t),t.onTextureLoaded({callback:function(){for(let e of t.getAllTextures())w.objects.texture[e.name]=e.texture}})}static getTexture({name:t}={}){if(void 0!==w.objects.texture[t])return w.objects.texture[t];console.warn('src: assetmanager: the texture you are trying to load does not exists: "'+t+'"')}static getAudio({name:t}={}){return w.objects.audio[t]}static onTextureLoaded({name:t,callback:e}={}){w.getTexture({name:t})?function i(){w.getTexture({name:t}).loaded?e():setTimeout(i,30)}():console.warn("src: AssetManager: The texture you're subscribing the loaded event for does not exists")}static onAudioLoaded({name:t,callback:e}={}){w.getAudio({name:t})?function i(){w.getAudio({name:t}).loaded?e():setTimeout(i,30)}():console.warn("src: AssetManager: The audio you've subscribed the loaded event for does not exists")}static onResourcesLoaded({callback:t}={}){!function e(){let i=!0;for(let t of w.objects.textureAtlases)t.textureLoaded||(i=!1);for(let t of Object.values(w.objects.texture))t.loaded||(i=!1);for(let t of Object.values(w.objects.audio))t.loaded||(i=!1);i?t():setTimeout(e,30)}()}static async allResourcesLoaded(){return new Promise(function(t,e){!function e(){let i=!0;for(let t of Object.values(w.objects.texture))t.loaded||(i=!1);for(let t of Object.values(w.objects.audio))t.loaded||(i=!1);if(i)return t();setTimeout(e,30)}()})}}w.objects={audio:{},texture:{},textureAtlases:[]};class b{static info(){-1===b.infoMessages.indexOf(arguments[0])&&(b.infoMessages.push(arguments[0]),console.info(...arguments))}static warn(){-1===b.warnedMessages.indexOf(arguments[0])&&(b.warnedMessages.push(arguments[0]),console.warn(...arguments))}static error(){-1===b.errorMessages.indexOf(arguments[0])&&(b.errorMessages.push(arguments[0]),console.warn(...arguments))}static isWebGLAvailable(){if(void 0!==b.storage.webGLEnabled)return b.storage.webGLEnabled;let t=document.createElement("canvas").getContext("webgl");return b.storage.webGLEnabled=!!t,b.storage.webGLEnabled}}b.infoMessages=[],b.warnedMessages=[],b.errorMessages=[],b.storage={webGLEnabled:void 0};class v{constructor({x:t,y:e,viewport:i,zoom:o}={viewport:{}}){this.coordinates=new n.Vec2D({x:t,y:e}),this.viewport={x:i.x||0,y:i.y||0,width:i.width,height:i.height},this.settings={mode:v.modes.CENTER,zoom:o||1},this.followingObject=void 0}shake({min:t,max:e,duration:i,smoothout:n}={}){let o=a.coordinates.x,r=a.coordinates.y,s=0,a=this,h=setInterval(function(){s+=16,a.coordinates={x:o,y:r},a.coordinates.x+=parseInt(((Math.random()<.5?-1:1)*t+Math.random()*(e-t))*(1==n?((i-i*(s/i))/i)**2:1)),a.coordinates.y+=parseInt(((Math.random()<.5?-1:1)*t+Math.random()*(e-t))*(1==n?((i-i*(s/i))/i)**2:1))},16);setTimeout(function(){console.log("END"),clearInterval(h),a.coordinates={x:o,y:r}},i)}followObject({object:t}={}){this.followingObject=t}renderToScreen({app:t,layers:e}={}){for(let i of e){(this.viewport.width>i.dimensions.width||this.viewport.height>i.dimensions.height)&&b.warn("src: camera: this camera's viewport is bigger than at least one layer. this can cause the renderer to not render the layer.",this,i);let e=Math.min(this.viewport.width,i.dimensions.width),n=Math.min(this.viewport.height,i.dimensions.height);t.project.renderer.renderTexture({texture:i,forceTextureUpload:!0,x:this.coordinates.x,y:this.coordinates.y,rotation:0,width:e*this.settings.zoom,height:n*this.settings.zoom,srcX:this.viewport.x+(e*this.settings.zoom-e)/2,srcY:this.viewport.y+(n*this.settings.zoom-n)/2,texWidth:i.dimensions.width*this.settings.zoom,texHeight:i.dimensions.height*this.settings.zoom})}}render({app:t,layers:e}={}){let i={x:0,y:0};void 0!==this.followingObject&&(i.x+=this.followingObject.position.x-this.viewport.x,i.y+=this.followingObject.position.y-this.viewport.y,this.settings.mode===v.modes.CENTER&&(i.x-=this.viewport.width/2+this.followingObject.dimensions.width/2,i.y-=this.viewport.height/2+this.followingObject.dimensions.width/2));for(let t of e)t.render({offset:{x:-i.x,y:-i.y},camera:this})}}v.modes={CENTER:0,ORIGIN:1};class R extends d{constructor({offset:t,width:e,height:i,rotation:o,rotationPosition:r,parentObject:s,debug:a}={}){super(),t=t||new n.Vec2D,this.offset=new n.Vec2D({x:t.x,y:t.y}),this.position=new n.Vec2D,this.rotation=void 0===o?0:o,this.rotationPosition=void 0===r?new n.Vec2D({x:parseInt(e/2),y:parseInt(i/2)}):new n.Vec2D({x:r.x,y:r.y}),this.parentObject=s,this.dimensions={width:e,height:i},this.debug={enabled:null!=a,hitbox:null!=a&&null!=a.hitbox&&a.hitbox}}onInit({object:t}={},e=this){e.position.x=t.position.x+e.offset.x,e.position.y=t.position.y+e.offset.y}onCalc({timestep:t,object:e}={},i=this){i.position=e.position.add({vector:i.offset}),i.rotation=e.rotation,i.rotationPosition=e.rotationPosition.sub({vector:i.offset})}}class L extends R{constructor({x:t,y:e,offset:i,radius:n,rotation:o,rotationPosition:r,parentObject:s,debug:a}={}){super({x:t,y:e,offset:i,width:2*n,height:2*n,rotation:o,rotationPosition:r,parentObject:s,debug:a})}onAfterRender({object:t,renderer:e}){if(this.debug.hitbox){let t=this.position.x+this.offset.x,i=this.position.y+this.offset.y;e.strokeCircle({x:t,y:i,radius:this.dimensions.width/2,angleStart:0,angleEnd:2*Math.PI,color:"#de5a1f",rotation:this.rotation,rotationPosition:this.rotationPosition,lineWidth:2})}}}class j extends R{constructor({offset:t,width:e,height:i,rotation:n,rotationPosition:o,parentObject:r,debug:s}={}){super({offset:t,width:e,height:i,rotation:n,rotationPosition:o,parentObject:r,debug:s})}onAfterRender({object:t,renderer:e}){if(this.debug.hitbox){let t=this.position.x+this.offset.x,i=this.position.y+this.offset.y;e.strokeRect({x:t,y:i,width:this.dimensions.width,height:this.dimensions.height,color:"#de5a1f",rotation:this.rotation,rotationPosition:this.rotationPosition,lineWidth:2})}}getCorners(t=this){let e=t.position.add({vector:t.rotationPosition});return{upperLeft:{x:e.x+((t.position.x-e.x)*Math.cos(t.rotation)-(t.position.y-e.y)*Math.sin(t.rotation)),y:e.y+((t.position.x-e.x)*Math.sin(t.rotation)+(t.position.y-e.y)*Math.cos(t.rotation))},upperRight:{x:e.x+((t.position.x+t.dimensions.width-e.x)*Math.cos(t.rotation)-(t.position.y-e.y)*Math.sin(t.rotation)),y:e.y+((t.position.x+t.dimensions.width-e.x)*Math.sin(t.rotation)+(t.position.y-e.y)*Math.cos(t.rotation))},lowerLeft:{x:e.x+((t.position.x-e.x)*Math.cos(t.rotation)-(t.position.y-e.y+t.dimensions.height)*Math.sin(t.rotation)),y:e.y+((t.position.x-e.x)*Math.sin(t.rotation)+(t.position.y-e.y+t.dimensions.height)*Math.cos(t.rotation))},lowerRight:{x:e.x+((t.position.x+t.dimensions.width-e.x)*Math.cos(t.rotation)-(t.position.y-e.y+t.dimensions.height)*Math.sin(t.rotation)),y:e.y+((t.position.x+t.dimensions.width-e.x)*Math.sin(t.rotation)+(t.position.y-e.y+t.dimensions.height)*Math.cos(t.rotation))}}}}class T{constructor({x:t,y:e,width:i,height:o,rotation:r,rotationPosition:s,tag:a,z:h,debug:c}={}){this.position=new n.Vec2D({x:t,y:e}),void 0!==i&&void 0!==o||b.warn("src: gameobject: either a width or a height is missing, while creating this gameobject. keep in mind that this also sets the rotation position to (0,0).",this),this.dimensions={width:i,height:o},this.z=h||0,this.rotation=r||0,this.rotationPosition=s||new n.Vec2D({x:parseInt(i/2),y:parseInt(o/2)}),this.tag=a,this.settings={collision:{targets:void 0}},this.components={},this.layer=void 0,this.debug={enabled:null!=c,hitbox:null!=c&&null!=c.hitbox&&c.hitbox}}setLayer({layer:t}){this.layer=t}getLayer(){return this.layer}calc({timestep:t}){for(let e of Object.values(this.components))"function"==typeof e.onCalc&&e.onCalc({timestep:t,object:this})}onBeforeRender({renderer:t}){for(let e of Object.values(this.components))"function"==typeof e.onBeforeRender&&e.onBeforeRender({object:this,renderer:t})}onAfterRender({renderer:t}){for(let e of Object.values(this.components))"function"==typeof e.onAfterRender&&e.onAfterRender({object:this,renderer:t})}render({x:t,y:e,width:i,height:n,renderer:o}){}addComponent({name:t,component:e}={}){t=t||"component"+Object.keys(this.components).length.toString(),this.components[t]=e,"function"==typeof e.onInit&&e.onInit({object:this})}getComponent({name:t}){return this.components[t]}removeComponent({name:t}={}){delete this.components[t],"function"==typeof component.onDestroy&&component.onDestroy({object:this})}}class P extends T{constructor({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,angleStart:s,angleEnd:a,tag:h,z:c,color:d}={}){super({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,z:c,tag:h}),this.angleStart=s||0,this.angleEnd=a||2*Math.PI,this.color=d||new p}calc({timestep:t}={}){for(let e of this.components)"function"==typeof e.onCalc&&e.onCalc({timestep:t,object:this})}render({x:t,y:e,renderer:i}={}){this.onBeforeRender({renderer:i});let n=t+this.dimensions.width/2,o=e+this.dimensions.height/2,r=this.dimensions.width/2;i.fillCircle({x:n,y:o,radius:r,rotation:this.rotation,rotationPosition:this.rotationPosition,angleStart:this.angleStart,angleEnd:this.angleEnd,color:this.color,ctx:this.layer.ctx}),this.onAfterRender({renderer:i})}}class E extends T{constructor({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,tag:s,color:a,z:h}={}){super({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,z:h,tag:s}),this.color=a||new p}calc({timestep:t}={}){for(let e of this.components)"function"==typeof e.onCalc&&e.onCalc({timestep:t,object:this})}render({x:t,y:e,renderer:i}={}){this.onBeforeRender({renderer:i}),i.fillRect({x:t,y:e,width:this.dimensions.width,height:this.dimensions.height,color:this.color,rotation:this.rotation,rotationPosition:this.rotationPosition}),this.onAfterRender({renderer:i})}}class M extends T{constructor({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,tag:s,texture:a,z:h}={}){super({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,tag:s,z:h}),this.texture=a,this.rendering={canvas:document.createElement("canvas"),ctx:void 0,data:void 0},this.rendering.ctx=this.rendering.canvas.getContext("2d"),this.applyTexture()}render({x:t,y:e,renderer:i}={}){this.onBeforeRender({renderer:i}),this.texture&&this.texture.loaded&&i.renderTexture({texture:this.texture,x:t+this.texture.getOffset().x,y:e+this.texture.getOffset().y,width:this.texture.getWidth(),height:this.texture.getHeight(),rotation:this.rotation,rotationPosition:this.rotationPosition,ctx:this.layer.ctx}),this.onAfterRender({renderer:i})}applyTexture(){void 0===this.dimensions.width&&(this.dimensions.width=this.texture.getTexture().width),void 0===this.dimensions.height&&(this.dimensions.height=this.texture.getTexture().height),this.texture&&(this.rendering.canvas.width=this.texture.getTexture().width,this.rendering.canvas.height=this.texture.getTexture().height,this.rendering.ctx.drawImage(this.texture.getTexture(),0,0))}setTexture({texture:t}){this.texture=t,this.applyTexture()}}class S extends T{constructor({x:t,y:e,tag:i,radius:n,innerRadius:o,intensity:r,hue:s}={}){super({x:t,y:e,width:2*n,height:2*n,tag:i}),this.radius=n,this.innerRadius=o||0,this.intensity=r||1,this.hue=s||new p,this.followingGameObject=void 0,this.computeLightMap()}followObject({object:t}={}){this.followingObject=t}unfollowObject(){this.followingObject=void 0}computeLightMap(){let t=document.createElement("canvas");t.width=this.dimensions.width,t.height=this.dimensions.height;let e=t.getContext("2d");e.fillStyle="black",e.fillRect(0,0,2*this.radius,2*this.radius);let i=e.createRadialGradient(this.radius,this.radius,this.innerRadius,this.radius,this.radius,this.radius);i.addColorStop(0,"rgba(255, 255, 255, "+this.intensity+")"),i.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=i,e.beginPath(),e.arc(this.radius,this.radius,this.radius,0,2*Math.PI),e.fill(),this.lightMapTexture=m.fromCanvas({canvas:t,ctx:e})}render({x:t,y:e,renderer:i}={}){let n={x:t,y:e};void 0!==this.followingObject&&(n.x+=this.followingObject.position.x+this.followingObject.dimensions.width/2-this.position.x,n.y+=this.followingObject.position.y+this.followingObject.dimensions.height/2-this.position.y),i.renderTexture({texture:this.lightMapTexture,x:n.x-this.radius,y:n.y-this.radius,width:this.dimensions.width,height:this.dimensions.height,rotation:0})}}class C{constructor({identifier:t,x:e,y:i}){this.identifier=t,this.position={x:e,y:i}}}class A{static updateGamePads(){let t=navigator.getGamepads?navigator.getGamepads():[],e=[];for(let i of t)null!=i&&e.push(i);e!==A.inputs.gamepads&&(A.inputs.gamepads=e)}static hasGamePad({idx:t}={}){return void 0!==A.getGamePad({idx:t})}static getGamePad({idx:t}={}){return A.inputs.gamepads[t]}static isKeyDown({key:t}={}){return A.keydown.hasOwnProperty(t)&&A.keydown[t]}static getTouches(){return A.inputs.touches}}A.keydown={},A.inputs={touches:[],gamepads:[]},A.cursor={isdown:!1,x:0,y:0},window.addEventListener("keydown",function(t){A.keydown[t.key]=!0}),window.addEventListener("keyup",function(t){delete A.keydown[t.key]}),window.addEventListener("mousedown",function(t){A.cursor.isdown=!0,A.cursor.x=t.clientX,A.cursor.y=t.clientY}),window.addEventListener("mouseup",function(t){A.cursor.isdown=!1}),window.addEventListener("mousemove",function(t){A.cursor.x=t.clientX,A.cursor.y=t.clientY}),window.addEventListener("touchstart",function(t){for(let e of t.touches)A.inputs.touches.push(new C({identifier:e.identifier,x:e.clientX,y:e.clientY}))}),window.addEventListener("touchmove",function(t){for(let e of t.touches)A.inputs.touches.filter(t=>t.identifier===e.identifier)[0].position={x:e.clientX,y:e.clientY}}),window.addEventListener("touchend",function(t){for(let e of t.changedTouches){let t=A.inputs.touches.filter(t=>t.identifier===e.identifier)[0];A.inputs.touches.splice(A.inputs.touches.indexOf(t),1)}}),window.addEventListener("touchcancel",function(t){for(let e of t.changedTouches){let t=A.inputs.touches.filter(t=>t.identifier===e.identifier)[0];A.inputs.touches.splice(A.inputs.touches.indexOf(t),1)}});class _{constructor(){this.canvas=void 0,this.ctx=void 0,this.initialized=!1}getCanvas(){return this.canvas}init(){this.initialized=!0}destroy(){this.ctx=null,this.canvas=null,this.initialized=!1}isInitialized(){return this.initialized}clearRect({x:t,y:e,width:i,height:n,layer:o}){}fillRect({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,color:s,layer:a}){}strokeRect({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,lineWidth:s,color:a,layer:h}){}fillCircle({x:t,y:e,radius:i,rotation:n,rotationPosition:o,angleStart:r,angleEnd:s,color:a,layer:h}){}strokeCircle({x:t,y:e,radius:i,rotation:n,rotationPosition:o,angleStart:r,angleEnd:s,lineWidth:a,color:h,layer:c}){}}let O=Float32Array;function I(t,e,i,n,o,r,s){return(s=s||new O(16))[0]=2/(e-t),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/(n-i),s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2/(o-r),s[11]=0,s[12]=(t+e)/(t-e),s[13]=(i+n)/(i-n),s[14]=(o+r)/(o-r),s[15]=1,s}function D(t,e,i,n,o){o=o||new O(16);var r=t[0],s=t[1],a=t[2],h=t[3],c=t[4],d=t[5],l=t[6],u=t[7],x=t[8],g=t[9],p=t[10],f=t[11],m=t[12],y=t[13],w=t[14],b=t[15];return t!==o&&(o[0]=r,o[1]=s,o[2]=a,o[3]=h,o[4]=c,o[5]=d,o[6]=l,o[7]=u,o[8]=x,o[9]=g,o[10]=p,o[11]=f),o[12]=r*e+c*i+x*n+m,o[13]=s*e+d*i+g*n+y,o[14]=a*e+l*i+p*n+w,o[15]=h*e+u*i+f*n+b,o}function k(t,e,i,n){n=n||new O(16);var o=e[0],r=e[1],s=e[2],a=Math.sqrt(o*o+r*r+s*s),h=(o/=a)*o,c=(r/=a)*r,d=(s/=a)*s,l=Math.cos(i),u=Math.sin(i),x=1-l,g=h+(1-h)*l,p=o*r*x+s*u,f=o*s*x-r*u,m=o*r*x-s*u,y=c+(1-c)*l,w=r*s*x+o*u,b=o*s*x+r*u,v=r*s*x-o*u,R=d+(1-d)*l,L=t[0],j=t[1],T=t[2],P=t[3],E=t[4],M=t[5],S=t[6],C=t[7],A=t[8],_=t[9],I=t[10],D=t[11];return n[0]=g*L+p*E+f*A,n[1]=g*j+p*M+f*_,n[2]=g*T+p*S+f*I,n[3]=g*P+p*C+f*D,n[4]=m*L+y*E+w*A,n[5]=m*j+y*M+w*_,n[6]=m*T+y*S+w*I,n[7]=m*P+y*C+w*D,n[8]=b*L+v*E+R*A,n[9]=b*j+v*M+R*_,n[10]=b*T+v*S+R*I,n[11]=b*P+v*C+R*D,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n}function F(t,e,i,n,o){return(o=o||new O(16))[0]=e*t[0],o[1]=e*t[1],o[2]=e*t[2],o[3]=e*t[3],o[4]=i*t[4],o[5]=i*t[5],o[6]=i*t[6],o[7]=i*t[7],o[8]=n*t[8],o[9]=n*t[9],o[10]=n*t[10],o[11]=n*t[11],t!==o&&(o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o}class B extends _{constructor(){super()}init({width:t,height:e,useLightningShaders:i,useOffscreenCanvas:n}){super.init(),this.webGLTextureStore={},(n=n||!1)&&void 0!==window.OffscreenCanvas?(this.canvas=new OffscreenCanvas(t,e),this.ctx=this.canvas.getContext("webgl2"),b.info("src: webgl: support for OffscreenCanvas detected and used")):(this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.ctx=this.canvas.getContext("webgl"),this.ctx.imageSmoothingEnabled=!1,this.canvas.setAttribute("style","image-rendering: optimizeSpeed; image-rendering: -moz-crisp-edges; image-rendering: -webkit-optimize-contrast; image-rendering: -o-crisp-edges; image-rendering: pixelated;")),this.program=i?z.createProgramLightning({ctx:this.ctx}):z.createProgram({ctx:this.ctx}),this.positionLocation=this.ctx.getAttribLocation(this.program,"a_position"),this.texcoordLocation=this.ctx.getAttribLocation(this.program,"a_texcoord"),this.matrixLocation=this.ctx.getUniformLocation(this.program,"u_matrix"),this.textureMatrixLocation=this.ctx.getUniformLocation(this.program,"u_textureMatrix"),this.textureLocation=this.ctx.getUniformLocation(this.program,"u_texture"),this.positionBuffer=this.ctx.createBuffer(),this.ctx.bindBuffer(this.ctx.ARRAY_BUFFER,this.positionBuffer),i?(this.ctx.enable(this.ctx.BLEND),this.ctx.blendFunc(this.ctx.ONE,this.ctx.ONE),this.ctx.blendEquation(this.ctx.FUNC_REVERSE_SUBTRACT)):(this.ctx.enable(this.ctx.BLEND),this.ctx.blendFunc(this.ctx.SRC_ALPHA,this.ctx.ONE_MINUS_SRC_ALPHA)),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],this.ctx.bufferData(this.ctx.ARRAY_BUFFER,new Float32Array(this.positions),this.ctx.STATIC_DRAW),this.texcoordBuffer=this.ctx.createBuffer(),this.ctx.bindBuffer(this.ctx.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],this.ctx.bufferData(this.ctx.ARRAY_BUFFER,new Float32Array(this.texcoords),this.ctx.STATIC_DRAW),this.ctx.useProgram(this.program),this.ctx.bindBuffer(this.ctx.ARRAY_BUFFER,this.positionBuffer),this.ctx.enableVertexAttribArray(this.positionLocation),this.ctx.vertexAttribPointer(this.positionLocation,2,this.ctx.FLOAT,!1,0,0),this.ctx.bindBuffer(this.ctx.ARRAY_BUFFER,this.texcoordBuffer),this.ctx.enableVertexAttribArray(this.texcoordLocation),this.ctx.vertexAttribPointer(this.texcoordLocation,2,this.ctx.FLOAT,!1,0,0),this.ctx.viewport(0,0,this.canvas.width,this.canvas.height)}destroy(){for(let t of Object.values(this.webGLTextureStore))this.ctx.deleteTexture(t);this.ctx.getExtension("WEBGL_lose_context").loseContext(),super.destroy()}clear({color:t}={}){t&&this.ctx.clearColor(t.r/255,t.g/255,t.b/255,t.a),this.ctx.clear(this.ctx.COLOR_BUFFER_BIT)}fillRect({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,color:s,ctx:a}){let h=this.ctx.createTexture();this.ctx.bindTexture(this.ctx.TEXTURE_2D,h),this.ctx.texImage2D(this.ctx.TEXTURE_2D,0,this.ctx.RGBA,1,1,0,this.ctx.RGBA,this.ctx.UNSIGNED_BYTE,new Uint8Array([s.r,s.g,s.b,255*s.a]));let c=I(0,this.canvas.width,this.canvas.height,0,-1,1);o%(2*Math.PI)!=0?(c=D(c,t,e,0),c=D(c,i/2,n/2,0),c=D(c,.5,.5,0),c=D(c=F(c=k(c,[0,0,1],o),i,n,1),-.5,-.5,0)):c=F(c=D(c,t,e,0),i,n,1),this.ctx.uniformMatrix4fv(this.matrixLocation,!1,c),this.ctx.uniform1i(this.textureLocation,0),this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.ctx.deleteTexture(h)}strokeRect({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,lineWidth:s,color:a,ctx:h}){b.warn("src: webgl: strokeRect is not available in the WebGL-Renderer.")}fillCircle({x:t,y:e,radius:i,rotation:n,rotationPosition:o,angleStart:r,angleEnd:s,color:a,ctx:h}){b.warn("src: webgl: fillCircle is not available in the WebGL-Renderer.")}strokeCircle({x:t,y:e,radius:i,rotation:n,rotationPosition:o,angleStart:r,angleEnd:s,lineWidth:a,color:h,ctx:c}){b.warn("src: webgl: strokeCircle is not available in the WebGL-Renderer.")}renderTexture({texture:t,x:e,y:i,width:n,height:o,rotation:r,rotationPosition:s,srcX:a,srcY:h,texWidth:c,texHeight:d,forceTextureUpload:l}){a=a||0,h=h||0,c=c||n,d=d||o,l=l||!1,!t instanceof m&&console.error("src: webgl: renderTexture(...) expects argument texture to be element of Texture.",t);let u,x=t.getId();!l&&x in this.webGLTextureStore?(u=this.webGLTextureStore[x],this.ctx.bindTexture(this.ctx.TEXTURE_2D,u)):(u=this.ctx.createTexture(),this.ctx.bindTexture(this.ctx.TEXTURE_2D,u),this.ctx.texImage2D(this.ctx.TEXTURE_2D,0,this.ctx.RGBA,this.ctx.RGBA,this.ctx.UNSIGNED_BYTE,t.getTexture()),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MIN_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MAG_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_S,this.ctx.CLAMP_TO_EDGE),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_T,this.ctx.CLAMP_TO_EDGE),this.webGLTextureStore[x]=u);let g=I(0,this.canvas.width,this.canvas.height,0,-1,1);r%(2*Math.PI)!=0?(g=D(g,e,i,0),g=D(g,s.x,s.y,0),g=D(g,s.x/n,s.y/o,0),g=D(g=F(g=k(g,[0,0,1],r),n,o,1),-s.x/n,-s.y/o,0)):g=F(g=D(g,e,i,0),n,o,1),this.ctx.uniformMatrix4fv(this.matrixLocation,!1,g);let p=(f=a/c,y=h/d,w=0,(b=b||new O(16))[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=f,b[13]=y,b[14]=w,b[15]=1,b);var f,y,w,b;p=F(p,n/c,o/d,1),this.ctx.uniformMatrix4fv(this.textureMatrixLocation,!1,p),this.ctx.uniform1i(this.textureLocation,0),this.ctx.drawArrays(this.ctx.TRIANGLES,0,6)}}class z{static get _vertexShader(){return"\n            attribute vec4 a_position;\n            attribute vec2 a_texcoord;\n            \n            uniform mat4 u_matrix;\n            uniform mat4 u_textureMatrix;\n            \n            varying vec2 v_texcoord;\n            \n            void main() {\n               gl_Position = u_matrix * a_position;\n               v_texcoord = (u_textureMatrix * vec4(a_texcoord, 0, 1)).xy;//a_texcoord;\n            }\n        "}static get _fragmentShader(){return"\n            precision mediump float;\n\n            varying vec2 v_texcoord;\n            \n            uniform sampler2D u_texture;\n            \n            void main() {\n                // ignore edges when image is positioned out of space \n                if (v_texcoord.x < 0.0 ||\n                   v_texcoord.y < 0.0 ||\n                   v_texcoord.x > 1.0 ||\n                   v_texcoord.y > 1.0) {\n                    discard;\n                }\n               gl_FragColor = texture2D(u_texture, v_texcoord);\n               gl_FragColor.rgb = ((gl_FragColor.rgb - 0.5) * max(1.0, 0.0)) + 0.5;\n            }\n        "}static get _fragmentShaderLighning(){return"\n            precision mediump float;\n\n            varying vec2 v_texcoord;\n            \n            vec4 c;\n            \n            uniform sampler2D u_texture;\n            \n            void main() {\n                // ignore edges when image is positioned out of space \n                if (v_texcoord.x < 0.0 ||\n                   v_texcoord.y < 0.0 ||\n                   v_texcoord.x > 1.0 ||\n                   v_texcoord.y > 1.0) {\n                    discard;\n                }\n               c = texture2D(u_texture, v_texcoord);\n               float r = 1.0;\n               float g = 1.0;\n               float b = 0.0;\n               float a = (0.299*(c.r) + 0.587*(c.g) + 0.114*(c.b));\n               gl_FragColor = vec4(1.0-(1.0-r)*a, 1.0-(1.0-g)*a, 1.0-(1.0-b)*a, a);\n            }\n        "}static createProgram({ctx:t}){let e=[z._compileShader({ctx:t,type:"VERTEX_SHADER",source:z._vertexShader}),z._compileShader({ctx:t,type:"FRAGMENT_SHADER",source:z._fragmentShader})];return z._linkProgram({ctx:t,shaders:e})}static createProgramLightning({ctx:t}){let e=[z._compileShader({ctx:t,type:"VERTEX_SHADER",source:z._vertexShader}),z._compileShader({ctx:t,type:"FRAGMENT_SHADER",source:z._fragmentShaderLighning})];return z._linkProgram({ctx:t,shaders:e})}static _linkProgram({ctx:t,shaders:e}){let i=t.createProgram();return e.forEach(function(e){t.attachShader(i,e)}),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)?i:(console.warn("src: webgl: program could not be linked.",i,t.getProgramInfoLog(i)),t.deleteProgram(i),null)}static _compileShader({ctx:t,type:e,source:i}){let n=t.createShader(t[e]);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.warn("src: webgl: shader could not be compiled.",n,t.getShaderInfoLog(n)),t.deleteShader(n),null)}}class G{constructor(){this.objects={}}destroy(){this.objects={}}addObject({name:t,object:e}={}){this.objects[t]=e}getObject({name:t}){return this.objects[t]}removeObject({name:t}){delete this.objects[t]}reorderObjects(){let t=Object.values(this.objects);return t.sort(function(t,e){return t.z<e.z?-1:t.z>e.z?1:this.indexOf(t)-this.indexOf(e)}.bind(t)),t}calc({timestep:t}={}){for(let e of this.getObjects())e.calc({timestep:t})}getObjects(){return this.reorderObjects()}}class U{constructor({width:t,height:e,renderer:i}={}){this.dimensions={width:t,height:e},this.id=f.ID(),this.scene=void 0,this.renderer=i||new B,this.objectmanager=new G}getId(){return this.id}init(){this.renderer.init({width:this.dimensions.width,height:this.dimensions.height,useOffscreenCanvas:!0})}destroy(){this.renderer.destroy(),this.objectmanager.destroy()}setScene({scene:t}){this.scene=t}getScene(){return this.scene}getTexture(){return this.renderer.getCanvas()}calc({timestep:t}){this.objectmanager.calc({timestep:t})}render({offset:t,camera:e}){for(let i of this.objectmanager.getObjects())i.render({x:t.x+i.position.x,y:t.y+i.position.y,width:i.dimensions.width,height:i.dimensions.height,camera:e,renderer:this.renderer})}clear(t=this){this.renderer.clear()}addObject({name:t,object:e}){e.setLayer({layer:this}),t=t||"object"+Object.keys(this.objectmanager.objects).length.toString(),this.objectmanager.addObject({name:t,object:e})}getObject({name:t}){return this.objectmanager.getObject({name:t})}removeObject({name:t}){this.objectmanager.removeObject({name:t})}}class N extends U{constructor({width:t,height:e,renderer:i}={}){super({width:t,height:e,renderer:i})}}class V extends U{constructor({width:t,height:e,globalLight:i}={}){super({width:t,height:e,renderer:new B}),this.globalLight=i||0,b.isWebGLAvailable()||b.warn("src: Layer.Lightning: To support light, make sure WebGL is supported by your browser"),this.backgroundColor=new p({a:1-Math.min(1,Math.abs(this.globalLight))})}init(){this.renderer.init({width:this.dimensions.width,height:this.dimensions.height,useLightningShaders:!0,useOffscreenCanvas:!0})}clear(t=this){this.renderer.clear({color:this.backgroundColor})}}class W extends T{constructor({x:t,y:e,width:i,height:n,velocity:o,acceleration:r,rotation:s,rotationPosition:h,renderObject:c,tag:d,z:l}={}){super({x:t,y:e,width:i||5,height:n||5,rotation:s,rotationPosition:h,z:l,tag:d}),this.velocity={x:o&&o.x?o.x:0,y:o&&o.y?o.y:0},this.acceleration={x:r&&r.x?r.x:0,y:r&&r.y?r.y:0},this.dead=!0,this.renderObject=c||new a.Rectangle({x:this.position.x,y:this.position.y,width:5,height:5,color:new p,layer:this.layer})}calc({timestep:t}={}){for(let e of Object.values(this.components))"function"==typeof e.onCalc&&e.onCalc({timestep:t,object:this});this.position={x:this.position.x+this.velocity.x*t,y:this.position.y+this.velocity.y*t},this.velocity={x:this.velocity.x+this.acceleration.x*t,y:this.velocity.y+this.acceleration.y*t}}render({x:t,y:e,renderer:i}={}){this.onBeforeRender({renderer:i}),this.renderObject||b.warn("src: particle: You're trying to render a particle, that has no render object. please specify any kind of gameobject e.g. a rectangle"),t+=this.position.x,e+=this.position.y,this.renderObject.render({x:t,y:e,renderer:i}),this.onAfterRender({renderer:i})}}class X extends _{constructor({}={}){super({})}init({width:t,height:e}){super.init(),this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1,this.canvas.setAttribute("style","image-rendering: optimizeSpeed; image-rendering: -moz-crisp-edges; image-rendering: -webkit-optimize-contrast; image-rendering: -o-crisp-edges; image-rendering: pixelated;")}getCanvas(){return this.canvas}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}fillRect({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,color:s}){o%(2*Math.PI)!=0&&(this.ctx.save(),this.ctx.translate(t+r.x,e+r.y),t=-r.x,e=-r.y,this.ctx.rotate(o)),this.ctx.fillStyle=s.toString(),this.ctx.fillRect(t,e,i,n),o%(2*Math.PI)!=0&&this.ctx.restore()}strokeRect({x:t,y:e,width:i,height:n,rotation:o,rotationPosition:r,lineWidth:s,color:a}){o%(2*Math.PI)!=0&&(this.ctx.save(),this.ctx.translate(t+r.x,e+r.y),t=-r.x,e=-r.y,this.ctx.rotate(o)),this.ctx.beginPath(),this.ctx.strokeStyle=a.toString(),this.ctx.lineWidth=s,this.ctx.rect(parseInt(t+s/2),parseInt(e+s/2),parseInt(i-s),parseInt(n-s)),this.ctx.stroke(),o%(2*Math.PI)!=0&&this.ctx.restore()}fillCircle({x:t,y:e,radius:i,rotation:n,rotationPosition:o,angleStart:r,angleEnd:s,color:a}){n%(2*Math.PI)!=0&&(this.ctx.save(),this.ctx.translate(t,e),t=+o.x-i,e=+o.y-i,this.ctx.rotate(n)),this.ctx.fillStyle=a.toString(),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.arc(t,e,i,r,s),this.ctx.closePath(),this.ctx.fill(),n%(2*Math.PI)!=0&&this.ctx.restore()}strokeCircle({x:t,y:e,radius:i,rotation:n,rotationPosition:o,angleStart:r,angleEnd:s,lineWidth:a,color:h}){n%(2*Math.PI)!=0&&(this.ctx.save(),this.ctx.translate(t,e),t=+o.x-i,e=+o.y-i,this.ctx.rotate(n)),this.ctx.beginPath(),this.ctx.strokeStyle=h.toString(),this.ctx.lineWidth=a,this.ctx.moveTo(t,e),this.ctx.arc(t,e,parseInt(i-a/2),r,s),this.ctx.closePath(),this.ctx.stroke(),n%(2*Math.PI)!=0&&this.ctx.restore()}renderTexture({texture:t,x:e,y:i,width:n,height:o,rotation:r,rotationPosition:s,srcX:a,srcY:h}){r%(2*Math.PI)!=0&&(this.ctx.save(),this.ctx.translate(e+s.x,i+s.y),e=-s.x,i=-s.y,this.ctx.rotate(r)),void 0!==a&&void 0!==h&&void 0!==n&&void 0!==o?this.ctx.drawImage(t.getTexture(),a,h,n,o,e,i,n,o):n&&o?this.ctx.drawImage(t.getTexture(),e,i,n,o):this.ctx.drawImage(t.getTexture(),e,i),r%(2*Math.PI)!=0&&this.ctx.restore()}}var Y=function(){var t=0,e=document.createElement("div");function i(t){return e.appendChild(t.dom),t}function n(i){for(var n=0;n<e.children.length;n++)e.children[n].style.display=n===i?"block":"none";t=i}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(i){i.preventDefault(),n(++t%e.children.length)},!1);var o=(performance||Date).now(),r=o,s=0,a=i(new Y.Panel("FPS","#0ff","#002")),h=i(new Y.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=i(new Y.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:i,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){s++;var t=(performance||Date).now();if(h.update(t-o,200),t>r+1e3&&(a.update(1e3*s/(t-r),100),r=t,s=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){o=this.end()},domElement:e,setMode:n}};Y.Panel=function(t,e,i){var n=1/0,o=0,r=Math.round,s=r(window.devicePixelRatio||1),a=80*s,h=48*s,c=3*s,d=2*s,l=3*s,u=15*s,x=74*s,g=30*s,p=document.createElement("canvas");p.width=a,p.height=h,p.style.cssText="width:80px;height:48px";var f=p.getContext("2d");return f.font="bold "+9*s+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=i,f.fillRect(0,0,a,h),f.fillStyle=e,f.fillText(t,c,d),f.fillRect(l,u,x,g),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(l,u,x,g),{dom:p,update:function(h,m){n=Math.min(n,h),o=Math.max(o,h),f.fillStyle=i,f.globalAlpha=1,f.fillRect(0,0,a,u),f.fillStyle=e,f.fillText(r(h)+" "+t+" ("+r(n)+"-"+r(o)+")",c,d),f.drawImage(p,l+s,u,x-s,g,l,u,x-s,g),f.fillRect(l+x-s,u,s,g),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(l+x-s,u,s,r((1-h/m)*g))}}};let H={Application:class{constructor({width:t,height:e,renderer:i,logFPS:n}={}){let o=this;this.scenes={all:[],active:void 0,activeName:void 0},this.project={width:t,height:e,logFPS:n||!1,pixelated:!0,renderer:i||new c.Canvas2D},this.frames={frame:0},this.fps={starttime:void 0,rate:1e3/60,deltatime:0,timestep:1,maxskippingframes:5},n&&(this.stats=new Y,this.stats.showPanel(0),document.body.appendChild(this.stats.dom)),this.project.renderer.init({width:t,height:e}),this.view=this.project.renderer.getCanvas(),window.requestAnimationFrame(function(t){o.render(t,o)})}render(t,e=this){if(void 0===e.fps.starttime)e.fps.starttime=t,e.fps.lastFrame=Math.round((t-e.fps.starttime)/e.fps.rate);else{let i=Math.round((t-e.fps.starttime)/e.fps.rate);e.fps.deltatime=(i-e.fps.lastFrame)*(1e3/60),e.fps.timestep=Math.min(e.fps.deltatime/e.fps.rate,e.fps.maxskippingframes),e.fps.lastFrame=i}A.updateGamePads(),void 0!==e.scenes.active&&(e.project.logFPS&&this.stats.begin(),e.scenes.active.calc({timestep:e.fps.timestep}),e.scenes.active.render({app:e}),e.project.logFPS&&this.stats.end()),window.requestAnimationFrame(function(t){e.render(t,e)})}addScene({name:t,scene:e}={}){e.setApplication({application:this}),this.scenes.all[t]=e}loadScene({name:t}={}){this.destroyCurrentScene(),this.scenes.all[t].init(),this.scenes.active=this.scenes.all[t],this.scenes.activeName=t}destroyCurrentScene(){this.scenes.activeName&&this.scenes.all[this.scenes.activeName].destroy()}reloadCurrentScene(){this.destroyCurrentScene(),this.scenes.active.init()}getCurrentSceneName(){return this.scenes.activeName}},Component:d,Animator:class extends d{constructor({animations:t,activeAnimation:e}){super(),this.animations=t,this.activeAnimation=e||Object.keys(t)[0],this.framecounter=0}onCalc({object:t}={}){this.framecounter++,t.texture=this.animations[this.activeAnimation].getTexture({frame:this.framecounter}),t.applyTexture()}setActiveAnimation({name:t}){this.activeAnimation!==t&&(this.activeAnimation=t,this.framecounter=0)}},Animation:class{constructor({frames:t,loop:e}){this.frames=t,this.loop=e||!0,this.animationLength=0;for(let e of t)this.animationLength+=e.duration||12}getTexture({frame:t}){if(!this.loop&&t>=this.animationLength)return this.frames[this.frames.length-1].texture;{let e=t%this.animationLength,i=0;for(let t of this.frames){if(i+t.duration>=e)return t.texture;i+=t.duration}return this.frames[0].texture}}},Assets:o,AssetManager:w,AudioController:class{},Camera:v,Colliders:r,CollisionManager:class{static colliding({obj1:t,obj2:e}={}){if(t instanceof R&&e instanceof R||(console.warn("src: collisions: you're asking for a collision between (at least) one non-collider object. fix that. "),console.trace()),"RectangleCollider"===t.constructor.name&&"RectangleCollider"===e.constructor.name){function i({axis:t,A:e,B:i}){let r=n({axis:t,point:e.upperRight}),s=n({axis:t,point:e.upperLeft}),a=n({axis:t,point:e.lowerRight}),h=n({axis:t,point:e.lowerLeft}),c=o({axis:t,point:r}),d=o({axis:t,point:s}),l=o({axis:t,point:a}),u=o({axis:t,point:h}),x=Math.max(u,l,d,c),g=Math.min(u,l,d,c),p=n({axis:t,point:i.upperRight}),f=n({axis:t,point:i.upperLeft}),m=n({axis:t,point:i.lowerRight}),y=n({axis:t,point:i.lowerLeft}),w=o({axis:t,point:p}),b=o({axis:t,point:f}),v=o({axis:t,point:m}),R=o({axis:t,point:y}),L=Math.max(R,v,b,w);return Math.min(R,v,b,w)<=x&&L>=g}function n({axis:t,point:e}={}){let i=(e.x*t.x+e.y*t.y)/(Math.pow(t.x,2)+Math.pow(t.y,2));return{x:i*t.x,y:i*t.y}}function o({axis:t,point:e}={}){return t.x*e.x+t.y+e.y}function r({obj1:t,obj2:e}){let i=e.position.add({vector:e.rotationPosition}),n=t.getCorners(),o=[],r={upperLeft:{x:i.x+((n.upperLeft.x-i.x)*Math.cos(-e.rotation)-(n.upperLeft.y-i.y)*Math.sin(-e.rotation)),y:i.y+((n.upperLeft.x-i.x)*Math.sin(-e.rotation)+(n.upperLeft.y-i.y)*Math.cos(-e.rotation))},upperRight:{x:i.x+((n.upperRight.x-i.x)*Math.cos(-e.rotation)-(n.upperRight.y-i.y)*Math.sin(-e.rotation)),y:i.y+((n.upperRight.x-i.x)*Math.sin(-e.rotation)+(n.upperRight.y-i.y)*Math.cos(-e.rotation))},lowerLeft:{x:i.x+((n.lowerLeft.x-i.x)*Math.cos(-e.rotation)-(n.lowerLeft.y-i.y)*Math.sin(-e.rotation)),y:i.y+((n.lowerLeft.x-i.x)*Math.sin(-e.rotation)+(n.lowerLeft.y-i.y)*Math.cos(-e.rotation))},lowerRight:{x:i.x+((n.lowerRight.x-i.x)*Math.cos(-e.rotation)-(n.lowerRight.y-i.y)*Math.sin(-e.rotation)),y:i.y+((n.lowerRight.x-i.x)*Math.sin(-e.rotation)+(n.lowerRight.y-i.y)*Math.cos(-e.rotation))}};return s({point:r.upperLeft,rect:e})&&o.push(n.upperLeft),s({point:r.upperRight,rect:e})&&o.push(n.upperRight),s({point:r.lowerLeft,rect:e})&&o.push(n.lowerLeft),s({point:r.lowerRight,rect:e})&&o.push(n.lowerRight),o}function s({point:t,rect:e}){return t.x>=e.position.x&&t.x<=e.position.x+e.dimensions.width&&t.y>=e.position.y&&t.y<=e.position.y+e.dimensions.height}let a=t.getCorners(),h=e.getCorners(),c={x:a.upperRight.x-a.upperLeft.x,y:a.upperRight.y-a.upperLeft.y},d={x:a.upperRight.x-a.lowerRight.x,y:a.upperRight.y-a.lowerRight.y},l={x:h.upperLeft.x-h.lowerLeft.x,y:h.upperLeft.y-h.lowerLeft.y},u={x:h.upperLeft.x-h.upperRight.x,y:h.upperLeft.y-h.upperRight.y};if(i({axis:c,A:a,B:h})&&i({axis:d,A:a,B:h})&&i({axis:l,A:a,B:h})&&i({axis:u,A:a,B:h})){let i=[];return i=(i=i.concat(r({obj1:t,obj2:e}))).concat(r({obj1:e,obj2:t}))}}else if("RectangleCollider"===t.constructor.name&&"CircleCollider"===e.constructor.name||"RectangleCollider"===e.constructor.name&&"CircleCollider"===t.constructor.name){function a({line:t,circle:e}={}){let i=[],n=t.x1-e.position.x-e.dimensions.width/2,o=t.y1-e.position.y-e.dimensions.width/2,r=t.x2-e.position.x-e.dimensions.width/2,s=t.y2-e.position.y-e.dimensions.width/2,a=r-n,h=s-o,c=Math.sqrt(a**2+h**2),d=n*s-r*o;if((e.dimensions.width/2)**2*c**2-d**2>0){let t=(d*h+u(h)*a*Math.sqrt((e.dimensions.width/2)**2*c**2-d**2))/c**2,x=(-d*a+Math.abs(h)*Math.sqrt((e.dimensions.width/2)**2*c**2-d**2))/c**2,g=(d*h-u(h)*a*Math.sqrt((e.dimensions.width/2)**2*c**2-d**2))/c**2,p=(-d*a-Math.abs(h)*Math.sqrt((e.dimensions.width/2)**2*c**2-d**2))/c**2,f={x:t+e.position.x+e.dimensions.width/2,y:x+e.position.y+e.dimensions.width/2},m={x:g+e.position.x+e.dimensions.width/2,y:p+e.position.y+e.dimensions.width/2};return l({a:t,a1:n,a2:r})&&l({a:x,a1:o,a2:s})&&i.push(f),l({a:g,a1:n,a2:r})&&l({a:p,a1:o,a2:s})&&i.push(m),i}function l({a:t,a1:e,a2:i}){return t<=e&&t>=i||t>=e&&t<=i}function u(t){return t<0?-1:1}return[]}let i="CircleCollider"===t.constructor.name?t:e,n="RectangleCollider"===t.constructor.name?t:e,o={x:n.position.x,y:n.position.y,width:n.dimensions.width,height:n.dimensions.height},r={x:n.position.x+n.rotationPosition.x,y:n.position.y+n.rotationPosition.y},s={x:i.position.x+i.dimensions.width/2,y:i.position.y+i.dimensions.width/2},h={x:r.x+((s.x-r.x)*Math.cos(-n.rotation)-(s.y-r.y)*Math.sin(-n.rotation))-i.dimensions.width/2,y:r.y+((s.x-r.x)*Math.sin(-n.rotation)+(s.y-r.y)*Math.cos(-n.rotation))-i.dimensions.width/2,radius:i.dimensions.width/2},c=h.x+h.radius,d=h.y+h.radius;if(h.x+h.radius<o.x?c=o.x:h.x+h.radius>o.x+o.width&&(c=o.x+o.width),h.y+h.radius<o.y?d=o.y:h.y+h.radius>o.y+o.height&&(d=o.y+o.height),(h.x+h.radius-c)**2+(h.y+h.radius-d)**2<=h.radius**2){let t={x1:n.getCorners().upperLeft.x,y1:n.getCorners().upperLeft.y,x2:n.getCorners().upperRight.x,y2:n.getCorners().upperRight.y},e={x1:n.getCorners().upperRight.x,y1:n.getCorners().upperRight.y,x2:n.getCorners().lowerRight.x,y2:n.getCorners().lowerRight.y},o={x1:n.getCorners().lowerRight.x,y1:n.getCorners().lowerRight.y,x2:n.getCorners().lowerLeft.x,y2:n.getCorners().lowerLeft.y},r={x1:n.getCorners().lowerLeft.x,y1:n.getCorners().lowerLeft.y,x2:n.getCorners().upperLeft.x,y2:n.getCorners().upperLeft.y},s=[];return s=(s=(s=(s=s.concat(a({line:t,circle:i}))).concat(a({line:e,circle:i}))).concat(a({line:o,circle:i}))).concat(a({line:r,circle:i}))}}return!1}},Color:p,GameObjects:a,Input:A,Layers:h,ObjectManager:G,ParticleSystem:class extends T{constructor({x:t,y:e,initiation:i,distribution:o,settings:r,tag:s,z:a}){super({x:t,y:e,width:0,height:0,z:a,tag:s}),this.position={x:0,y:0},this.dimensions=new n.Vec2D,this.settings={maxParticles:r&&r.maxParticles||500,particleLifespan:r&&r.particleLifespan||60,spawnRate:r&&r.spawnRate||500},this.distribution=o||this.defaultDistribution,this.initiation=i,this.state=0,this.frames=0,this.pool=[]}setLayer({layer:t}){super.setLayer({layer:t});for(let e=0;e<this.settings.maxParticles;e++){let e=new W;e.setLayer({layer:t}),this.pool.push(e),e.dead=!0,e.lifetime=0,this.initiation&&this.initParticle({particle:e})}}defaultDistribution({particle:t}={},e=this){t.position=e.position,t.velocity={x:f.range({min:-1,max:1}),y:f.range({min:-1,max:1})},t.acceleration={x:f.range({min:-1,max:1}),y:f.range({min:-1,max:1})}}resetParticle({particle:t,blockDistribution:e}={},i=this){t.lifetime=0,t.dead=!0}initParticle({particle:t}={},e=this){e.initiation({particle:t})}play(t=this){t.state=1}pause(t=this){t.state=2}stop(t=this){t.state=0;for(let e of t.pool)t.resetParticle({particle:e})}isPlaying(t=this){return 1===t.state}isPaused(t=this){return 2===t.state}isStopped(t=this){return 0===t.state}awakeParticle(t=this){for(let e=0;e<t.pool.length;e++)if(t.pool[e].dead)return t.distribution({particle:t.pool[e]}),t.pool[e].dead=!1,!0;return!1}calc({timestep:t}={},e=this){if(1===e.state){let i=60/e.settings.spawnRate*t;if(i>1)e.frames%parseInt(i)==0&&e.awakeParticle();else for(let t=0;t<parseInt(1/i)&&e.awakeParticle();t++);}if(0!==e.state)for(let i of e.pool)i.lifetime>=e.settings.particleLifespan?e.resetParticle({particle:i}):i.dead||(i.lifetime+=1,i.calc({timestep:t}));this.frames++}render({x:t,y:e,width:i,height:n,camera:o,renderer:r},s=this){if(0!==s.state)for(let i of s.pool)i.dead||i.render({x:t,y:e,width:i.dimensions.width,height:i.dimensions.height,camera:o,renderer:r})}},Random:f,Renderers:c,Scene:class{constructor(){this.layers=[],this.store={},this.initialized=!1,this.application=void 0,this.cameras={all:[]},this.onInitFn=function(){},this.onDestroyFn=function(){}}init(){"function"==typeof this.onInitFn&&this.onInitFn();for(let t of this.layers)t.init();this.initialized=!0}onInit({callback:t}){this.onInitFn=t}destroy(){if(this.initialized){for(let t of this.layers)t.destroy();"function"==typeof this.onDestroyFn&&this.onDestroyFn(),this.layers=[],this.store={},this.initialized=!1,this.cameras={all:[]}}}onDestroy({callback:t}){this.onDestroyFn=t}setApplication({application:t}){return this.application=t,this}getApplication(){return this.application}addLayer({layer:t}={}){return t.setScene({scene:this}),this.layers.push(t),this}calc({timestep:t}={}){for(let e of this.layers)e.calc({timestep:t});return this}clear(){for(let t of this.layers)t.clear();return this}render({app:t}={}){for(let e of this.cameras.all){for(let t of this.layers)t.clear();e.render({app:t,layers:this.layers}),e.renderToScreen({app:t,layers:this.layers})}return this}addCamera({camera:t}={}){return this.cameras.all.push(t),this}storeItem({name:t,item:e}){return this.store[t]=e,this}getStoredItem({name:t}){return this.store[t]}getStoredItems(){return this.store}clearStore(){return this.store={},this}},Vectors:n,Utils:b};window.fox=H;e.default=H}]);